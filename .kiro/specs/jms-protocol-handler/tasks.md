# Implementation Plan

- [x] 1. 创建macOS应用程序项目结构和基础配置
  - 创建新的macOS应用程序项目，配置Swift 5.0+和Cocoa框架
  - 设置Info.plist文件注册jms://协议处理
  - 配置应用程序基本属性和权限
  - 创建基础的目录结构和文件组织
  - _Requirements: 3.1, 3.2, 5.1_

- [x] 2. 实现数据模型和协议定义
  - 创建JMSConfig、ConnectionInfo等核心数据结构
  - 定义各个模块的协议接口
  - 实现JMSError错误枚举和错误处理协议
  - 编写数据模型的单元测试
  - _Requirements: 1.3, 4.1, 4.2, 4.3, 4.4_

- [x] 3. 实现URL解析和验证模块
  - 创建URLParser类实现URL格式验证
  - 实现jms://协议的URL解析逻辑
  - 提取base64编码的payload部分
  - 编写URL解析的单元测试，包括各种边界情况
  - _Requirements: 1.1, 1.2, 4.1_

- [x] 4. 实现Base64解码和JSON解析模块
  - 创建PayloadDecoder类实现base64解码功能
  - 实现JSON配置信息的解析逻辑
  - 添加解码失败和JSON格式错误的处理
  - 编写解码模块的单元测试，验证解码准确性
  - _Requirements: 1.2, 1.3, 4.2, 4.3_

- [x] 5. 实现连接信息提取模块（支持RDP和SSH协议）
  - 创建ConnectionInfoExtractor类支持协议类型识别
  - 实现RDP协议的config字符串解析（"full address:s:"和"username:s:"）
  - 实现SSH协议的token字段JSON解析（ip、port、username、password）
  - 解析其他RDP配置参数（session bpp、audiomode等）
  - 编写RDP和SSH连接信息提取的单元测试
  - _Requirements: 1.4, 1.5, 1.6, 1.7, 4.4_

- [x] 6. 实现错误处理和用户通知系统
  - 创建ErrorHandler类统一处理各种错误类型
  - 实现NotificationManager管理用户通知
  - 为每种错误类型提供用户友好的消息
  - 编写错误处理的单元测试
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 7. 实现显示器检测和配置模块
  - 创建DisplayDetector类检测主显示器和所有显示器配置
  - 实现HiDPI（Retina）显示器识别和参数计算
  - 检测多显示器环境并选择最优配置
  - 获取显示器分辨率、缩放因子、颜色深度等参数
  - 实现显示器配置变化的动态检测
  - 编写显示器检测的单元测试和集成测试
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 8. 实现RDP配置优化器
  - 创建RDPConfigOptimizer类根据显示器特性优化RDP参数
  - 实现基于HiDPI显示器的DPI缩放配置
  - 支持不同质量配置文件（性能/平衡/质量）
  - 生成完整的优化RDP配置文件内容
  - 处理特殊显示器配置（4K、超宽屏等）
  - 编写RDP配置优化的单元测试
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5, 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 9. 更新Remote Desktop集成器支持显示优化
  - 更新RemoteDesktopIntegrator集成DisplayDetector和RDPConfigOptimizer
  - 实现启动前的显示器检测和配置优化流程
  - 生成包含显示优化参数的RDP配置文件
  - 添加显示配置相关的错误处理
  - 支持动态显示器配置调整
  - 编写显示优化集成的单元测试
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5, 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 10. 实现SSH终端集成模块（SSH协议）
  - 创建SSHTerminalIntegrator类检测可用终端应用程序
  - 实现终端应用程序优先级检测（iTerm2 > Terminal）
  - 实现SSH命令构建，包含expect脚本自动密码输入
  - 使用AppleScript启动iTerm2或Terminal并执行SSH连接
  - 实现SSH连接失败和超时的错误处理
  - 编写SSH终端集成的单元测试和集成测试
  - _Requirements: 2.6, 2.7, 2.8, 2.9, 2.10, 2.11, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_

- [x] 11. 更新主应用程序控制器集成显示优化模块
  - 更新AppDelegate集成DisplayDetector和RDPConfigOptimizer
  - 在RDP连接建立前执行显示器检测和配置优化
  - 集成显示相关的错误处理和用户通知
  - 协调显示优化模块与其他模块的工作流程
  - 添加显示配置变化的处理逻辑
  - _Requirements: 3.3, 3.4, 8.1-8.5, 9.1-9.5_

- [x] 12. 集成所有模块并实现完整工作流程（包含显示优化）
  - 将显示优化模块集成到主应用程序中
  - 实现从URL接收到优化RDP连接的完整流程
  - 保持SSH终端连接的完整流程不变
  - 添加显示优化相关的错误处理和状态管理
  - 确保显示优化不影响SSH协议的处理
  - 测试显示器配置变化时的动态调整
  - _Requirements: 1.1-1.7, 2.1-2.11, 6.1-6.7, 7.1-7.6, 8.1-8.5, 9.1-9.5_

- [x] 13. 编写显示优化相关的测试用例
  - 创建显示器检测功能的单元测试
  - 创建RDP配置优化的单元测试
  - 测试不同显示器配置下的RDP参数生成
  - 测试HiDPI显示器的特殊处理
  - 测试多显示器环境的配置选择
  - 测试显示配置相关的错误处理
  - _Requirements: 8.1-8.5, 9.1-9.5_

- [x] 14. 编写集成测试和端到端测试（包含显示优化）
  - 更新RDP完整流程的集成测试，包含显示优化
  - 保持SSH完整流程的集成测试不变
  - 测试各种显示器配置下的RDP连接质量
  - 验证与Microsoft Remote Desktop的优化集成
  - 测试显示器配置变化时的处理
  - 测试不同质量配置文件的效果
  - 验证显示优化对性能的影响
  - _Requirements: 4.1-4.5, 6.1-6.7, 7.1-7.6, 8.1-8.5, 9.1-9.5_

- [x] 15. 性能优化和显示配置验证
  - 优化显示器检测的性能开销
  - 验证RDP配置优化对连接性能的改善
  - 测试不同显示器配置下的用户体验
  - 验证HiDPI显示器的配置正确性
  - 测试多显示器环境下的性能表现
  - 优化RDP配置文件生成的效率
  - 验证显示优化在macOS M4芯片上的效果
  - _Requirements: 5.1-5.4, 8.1-8.5, 9.1-9.5_

- [ ] 16. 应用程序打包和部署准备（包含显示优化功能）
  - 更新应用程序配置包含显示优化功能
  - 更新用户安装和使用说明，包含显示优化说明
  - 创建显示配置故障排除指南
  - 测试在不同显示器配置的macOS系统上的运行效果
  - 验证显示优化功能的完整工作流程
  - 创建显示配置使用指南和最佳实践文档
  - _Requirements: 3.1, 3.2, 5.5, 6.1-6.7, 7.1-7.6, 8.1-8.5, 9.1-9.5_