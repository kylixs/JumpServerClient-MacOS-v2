# JMS协议管理功能需求文档

## 📋 项目信息
- **功能名称**: JMS协议管理界面
- **版本**: v1.0.0
- **创建日期**: 2025-01-18
- **文档类型**: 功能需求规格说明书

## 🎯 功能概述

为JMS Protocol Handler应用添加图形化的协议管理界面，让用户能够方便地检查、管理和重新注册jms://协议处理器，解决多个应用争夺协议处理权的问题。

## 📊 需求背景

### 当前问题
1. **协议冲突**: 系统中可能存在多个jms://协议处理器
2. **注册复杂**: 用户需要手动运行脚本进行协议注册
3. **状态不明**: 用户无法直观了解协议注册状态
4. **管理困难**: 缺乏统一的协议管理入口

### 解决目标
- 提供图形化的协议管理界面
- 支持检查所有已注册的协议处理器
- 一键清理并重新注册协议
- 直观显示协议注册状态

## 🔧 功能需求

### 1. 菜单集成
**需求ID**: REQ-001
**优先级**: 高
**描述**: 在应用主菜单中添加"JMS协议管理..."菜单项

**具体要求**:
- 菜单位置: 状态栏菜单中，位于"显示RDP设置"和"关于"之间
- 菜单文字: "JMS协议管理..."
- 快捷键: 无（避免快捷键冲突）
- 点击行为: 打开协议管理窗口

### 2. 协议状态检查
**需求ID**: REQ-002
**优先级**: 高
**描述**: 检测并显示系统中所有已注册的jms://协议处理器

**具体要求**:
- 扫描系统中所有jms://协议处理器
- 显示处理器应用名称和路径
- 验证处理器路径的有效性
- 标识当前应用是否为注册处理器
- 支持手动刷新状态

**状态分类**:
- ✅ 当前应用 (绿色): 本应用已注册为处理器
- ⚠️ 其他应用 (黄色): 其他有效应用已注册
- ❌ 无效路径 (红色): 注册路径不存在或无效
- 🔄 检查中 (蓝色): 正在检查状态

### 3. 协议重新注册
**需求ID**: REQ-003
**优先级**: 高
**描述**: 清理现有协议注册并重新注册当前应用

**具体要求**:
- 清理所有现有的jms://协议注册
- 重新注册当前应用为唯一处理器
- 显示注册进度和结果
- 操作完成后自动刷新状态显示
- 提供操作成功/失败的用户反馈

### 4. 用户界面设计
**需求ID**: REQ-004
**优先级**: 中
**描述**: 设计简洁美观的协议管理界面

**界面要求**:
- 窗口标题: "JMS协议管理"
- 窗口大小: 420×280像素
- 最小尺寸: 380×250像素
- 支持窗口关闭按钮
- 界面风格与RDP设置窗口保持一致

**布局结构**:
```
┌─────────────────────────────────────────┐
│  JMS协议管理                      [×]    │
├─────────────────────────────────────────┤
│  📡 协议状态                            │
│  ┌─────────────────────────────────────┐ │
│  │ [处理器列表区域]                    │ │
│  │                                     │ │
│  └─────────────────────────────────────┘ │
│                                         │
│  🔧 协议操作                            │
│  [检查协议状态]    [重新注册协议]        │
│                                         │
│                    [关闭]               │
└─────────────────────────────────────────┘
```

## 📱 用户交互流程

### 主要用例
1. **查看协议状态**
   - 用户点击菜单"JMS协议管理..."
   - 系统打开管理窗口并自动检查协议状态
   - 显示所有已注册的处理器列表

2. **刷新协议状态**
   - 用户点击"检查协议状态"按钮
   - 系统重新扫描所有协议处理器
   - 更新显示列表和状态

3. **重新注册协议**
   - 用户点击"重新注册协议"按钮
   - 系统显示确认对话框
   - 用户确认后执行清理和重新注册
   - 显示操作进度和结果

## 🔒 非功能需求

### 性能要求
- 协议状态检查响应时间 < 2秒
- 协议重新注册完成时间 < 5秒
- 界面打开响应时间 < 1秒

### 兼容性要求
- 支持macOS 10.15+
- 兼容Apple Silicon和Intel处理器
- 支持不同分辨率显示器

### 可靠性要求
- 协议注册成功率 > 95%
- 状态检查准确率 100%
- 异常情况下提供友好错误提示

### 安全性要求
- 协议注册操作需要适当的系统权限
- 不影响其他应用的正常功能
- 操作日志记录用于问题排查

## 🚫 排除功能

以下功能明确不包含在此版本中:
- ❌ 协议测试功能
- ❌ 协议信息详细显示
- ❌ 测试结果展示区域
- ❌ 协议版本管理
- ❌ 批量协议操作

## 📋 验收标准

### 功能验收
- [ ] 菜单项正确添加到状态栏菜单
- [ ] 协议管理窗口能正常打开和关闭
- [ ] 能正确检测所有已注册的协议处理器
- [ ] 能准确显示处理器状态和路径信息
- [ ] 重新注册功能能成功清理并重新注册协议
- [ ] 操作完成后状态显示正确更新

### 界面验收
- [ ] 界面布局符合设计要求
- [ ] 状态图标和颜色正确显示
- [ ] 按钮功能正常响应
- [ ] 窗口大小和缩放正常
- [ ] 界面风格与应用整体一致

### 用户体验验收
- [ ] 操作流程直观易懂
- [ ] 错误提示友好明确
- [ ] 操作反馈及时准确
- [ ] 界面响应速度满足要求

## 📅 开发计划

### 里程碑
- **设计阶段**: 完成界面设计和技术方案 (1天)
- **开发阶段**: 实现核心功能和界面 (2-3天)
- **测试阶段**: 功能测试和用户体验优化 (1天)
- **集成阶段**: 与现有应用集成和最终测试 (1天)

### 风险评估
- **技术风险**: 协议注册API的兼容性问题
- **用户风险**: 界面复杂度可能影响用户体验
- **系统风险**: 协议注册可能需要管理员权限

## 📚 参考资料

- [macOS URL Scheme Registration Guide](https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app)
- [NSWorkspace Protocol Handler APIs](https://developer.apple.com/documentation/appkit/nsworkspace)
- [JMS Protocol Handler 现有实现](../implementation/)
- [协议注册脚本文档](../deployment/JMS_PROTOCOL_REGISTRATION_GUIDE.md)

---

**文档状态**: 待审核
**最后更新**: 2025-01-18
**审核人**: 待定
**批准人**: 待定
