# UIæ£€æŸ¥å™¨ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

UIæ£€æŸ¥å™¨æ˜¯ä¸€ä¸ªé€šç”¨çš„GUIç•Œé¢è°ƒè¯•å·¥å…·æ¨¡å—ï¼Œç”¨äºŽåˆ†æžå’Œè¯Šæ–­macOSåº”ç”¨ç¨‹åºçš„ç•Œé¢å¸ƒå±€é—®é¢˜ã€‚å®ƒæä¾›äº†è¯¦ç»†çš„è§†å›¾å±‚çº§åˆ†æžã€å¸ƒå±€é—®é¢˜æ£€æµ‹å’Œè‡ªåŠ¨ä¿®å¤åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ðŸ” æ ¸å¿ƒåŠŸèƒ½

1. **è§†å›¾å±‚çº§åˆ†æž**
   - ç”Ÿæˆå®Œæ•´çš„è§†å›¾ç»„ä»¶å±‚çº§æ ‘
   - æ˜¾ç¤ºæ¯ä¸ªè§†å›¾çš„è¯¦ç»†å±žæ€§ä¿¡æ¯
   - æ”¯æŒé€’å½’åˆ†æžæ‰€æœ‰å­è§†å›¾

2. **å¸ƒå±€é—®é¢˜æ£€æµ‹**
   - è‡ªåŠ¨æ£€æµ‹å¸¸è§çš„å¸ƒå±€é—®é¢˜
   - è¯†åˆ«è§†å›¾é‡å ã€è¶…å‡ºè¾¹ç•Œç­‰é—®é¢˜
   - åˆ†æžç©ºç™½åŒºåŸŸå’Œçº¦æŸé—®é¢˜

3. **è‡ªåŠ¨ä¿®å¤åŠŸèƒ½**
   - ä¿®å¤é›¶å°ºå¯¸è§†å›¾
   - è°ƒæ•´è¶…å‡ºè¾¹ç•Œçš„è§†å›¾
   - æä¾›æ™ºèƒ½ä¿®å¤å»ºè®®

4. **å®žæ—¶ç›‘æŽ§**
   - æ”¯æŒå®žæ—¶ç›‘æŽ§å¸ƒå±€å˜åŒ–
   - å®šæœŸæ£€æµ‹å’ŒæŠ¥å‘Šé—®é¢˜
   - é€‚ç”¨äºŽåŠ¨æ€ç•Œé¢è°ƒè¯•

## æ¨¡å—ç»“æž„

```
Sources/UIInspector/
â”œâ”€â”€ UIInspector.swift          # æ ¸å¿ƒæ£€æŸ¥å™¨
â””â”€â”€ UILayoutDebugger.swift     # å¸ƒå±€è°ƒè¯•å·¥å…·
```

### UIInspector.swift
- ä¸»è¦çš„UIæ£€æŸ¥å™¨ç±»
- æä¾›è§†å›¾å±‚çº§åˆ†æžåŠŸèƒ½
- ç”Ÿæˆè¯¦ç»†çš„å¸ƒå±€æŠ¥å‘Š

### UILayoutDebugger.swift
- ä¸“é—¨çš„å¸ƒå±€è°ƒè¯•å·¥å…·
- æä¾›é—®é¢˜è¯Šæ–­å’Œè‡ªåŠ¨ä¿®å¤
- æ”¯æŒå®žæ—¶ç›‘æŽ§åŠŸèƒ½

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

```swift
import UIInspector

// æ£€æŸ¥è§†å›¾å±‚çº§
view.inspectLayout(title: "æˆ‘çš„ç•Œé¢å¸ƒå±€")

// æ£€æŸ¥çª—å£å¸ƒå±€
window.inspectLayout(title: "ä¸»çª—å£å¸ƒå±€")
```

### 2. è¯¦ç»†è¯Šæ–­

```swift
// ä½¿ç”¨å¸ƒå±€è°ƒè¯•å·¥å…·è¿›è¡Œè¯¦ç»†è¯Šæ–­
UILayoutDebugger.shared.diagnoseLayout(
    view, 
    expectedLayout: "é¡¶éƒ¨æ ‡é¢˜ -> ä¸­é—´å†…å®¹ -> åº•éƒ¨æŒ‰é’®"
)
```

### 3. è‡ªåŠ¨ä¿®å¤

```swift
// è‡ªåŠ¨ä¿®å¤å¸¸è§å¸ƒå±€é—®é¢˜
UILayoutDebugger.shared.autoFixCommonIssues(view)
```

### 4. ç”ŸæˆæŠ¥å‘Š

```swift
// ç”Ÿæˆè¯¦ç»†çš„å¸ƒå±€æŠ¥å‘Š
let report = UIInspector.shared.generateLayoutReport(view, title: "ç•Œé¢åˆ†æžæŠ¥å‘Š")

// ä¿å­˜æŠ¥å‘Šåˆ°æ–‡ä»¶
UIInspector.shared.saveLayoutReport(view, title: "ç•Œé¢åˆ†æž", filename: "layout_report.txt")
```

### 5. å®žæ—¶ç›‘æŽ§

```swift
// å¼€å§‹å®žæ—¶ç›‘æŽ§å¸ƒå±€å˜åŒ–
UILayoutDebugger.shared.startLayoutMonitoring(view, interval: 2.0)
```

## è¾“å‡ºç¤ºä¾‹

### è§†å›¾å±‚çº§ç»“æž„
```
ðŸ“± JMSProtocolManagerViewController
    ðŸ“ Frame: (0, 0, 520, 300)
    ðŸ“ Bounds: (0, 0, 520, 300)
  ðŸ“„ NSTextField
      ðŸ“ Frame: (20, 180, 200, 20)
      ðŸ“ Bounds: (0, 0, 200, 20)
      ðŸ“ Text: "ðŸ“¡ åè®®çŠ¶æ€"
      ðŸŽ¨ Font: .AppleSystemUIFont
  ðŸ“„ NSTextField
      ðŸ“ Frame: (20, 160, 460, 16)
      ðŸ“ Bounds: (0, 0, 460, 16)
      ðŸ“ Text: "æ­£åœ¨æ£€æŸ¥åè®®çŠ¶æ€..."
  ðŸ“ NSScrollView
      ðŸ“ Frame: (20, 60, 460, 90)
      ðŸ“ Bounds: (0, 0, 460, 90)
      ðŸ“œ HasVerticalScroller: true
      ðŸ“œ HasHorizontalScroller: false
    ðŸ“š NSStackView
        ðŸ“ Frame: (0, 0, 460, 90)
        ðŸ“ Bounds: (0, 0, 460, 90)
        ðŸ“š Orientation: Vertical
        ðŸ“š Spacing: 8.0
        ðŸ“š ArrangedSubviews: 0
```

### å¸ƒå±€é—®é¢˜æ£€æµ‹
```
âš ï¸ æ£€æµ‹åˆ°å¸ƒå±€é—®é¢˜:
  - å‘çŽ°å¤§ç‰‡ç©ºç™½åŒºåŸŸ: ç©ºç™½æ¯”ä¾‹è¿‡é«˜: 65%
  - [NSStackView] NSStackViewæ²¡æœ‰arrangedSubviews

ðŸ’¡ ä¿®å¤å»ºè®®:
  - è€ƒè™‘è°ƒæ•´å­è§†å›¾ä½ç½®æˆ–å¢žåŠ å†…å®¹å¡«å……ç©ºç™½åŒºåŸŸ
  - ä¸ºNSStackViewæ·»åŠ arrangedSubviewsæˆ–æ£€æŸ¥æ•°æ®æº
```

## åœ¨JMSåè®®ç®¡ç†ç•Œé¢ä¸­çš„åº”ç”¨

### é›†æˆä»£ç 

```swift
import UIInspector

class JMSProtocolManagerViewController: NSViewController {
    
    override func viewDidLoad() {
        super.viewDidLoad()
        setupUI()
        
        // å»¶è¿Ÿæ‰§è¡ŒUIæ£€æŸ¥ï¼Œç¡®ä¿ç•Œé¢å®Œå…¨åŠ è½½
        DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) { [weak self] in
            guard let self = self else { return }
            
            // åŸºæœ¬UIæ£€æŸ¥
            self.view.inspectLayout(title: "JMSåè®®ç®¡ç†ç•Œé¢åˆå§‹å¸ƒå±€")
            
            // è¯¦ç»†å¸ƒå±€è¯Šæ–­
            UILayoutDebugger.shared.diagnoseLayout(
                self.view, 
                expectedLayout: "é¡¶éƒ¨çŠ¶æ€åŒºåŸŸ -> ä¸­é—´åˆ—è¡¨åŒºåŸŸ -> åº•éƒ¨æŒ‰é’®åŒºåŸŸ"
            )
            
            // è‡ªåŠ¨ä¿®å¤å¸¸è§é—®é¢˜
            UILayoutDebugger.shared.autoFixCommonIssues(self.view)
        }
        
        checkProtocolStatus()
    }
    
    private func updateHandlersList() {
        // ... æ›´æ–°é€»è¾‘
        
        // æ›´æ–°åŽå†æ¬¡æ£€æŸ¥å¸ƒå±€
        self.view.inspectLayout(title: "JMSåè®®ç®¡ç†ç•Œé¢æ›´æ–°åŽå¸ƒå±€")
    }
}
```

### è§£å†³çš„é—®é¢˜

é€šè¿‡UIæ£€æŸ¥å™¨ï¼Œæˆ‘ä»¬å‘çŽ°å¹¶è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š

1. **ç©ºç™½åŒºåŸŸè¿‡å¤§**
   - æ£€æµ‹åˆ°65%çš„ç©ºç™½æ¯”ä¾‹
   - å»ºè®®è°ƒæ•´è§†å›¾ä½ç½®å’Œå°ºå¯¸

2. **NSStackViewä¸ºç©º**
   - æ£€æµ‹åˆ°NSStackViewæ²¡æœ‰arrangedSubviews
   - æç¤ºæ£€æŸ¥æ•°æ®æºå’Œè§†å›¾æ·»åŠ é€»è¾‘

3. **åæ ‡ç³»ç»Ÿé—®é¢˜**
   - åˆ†æžè§†å›¾çš„å®žé™…Frameå’ŒBounds
   - ç¡®è®¤macOSåæ ‡ç³»ç»Ÿçš„æ­£ç¡®ä½¿ç”¨

## æœ€ä½³å®žè·µ

### 1. ä½¿ç”¨æ—¶æœº
- åœ¨`viewDidLoad`åŽå»¶è¿Ÿæ‰§è¡Œæ£€æŸ¥
- åœ¨ç•Œé¢æ›´æ–°åŽè¿›è¡ŒéªŒè¯
- åœ¨å‘çŽ°å¸ƒå±€é—®é¢˜æ—¶è¿›è¡Œè¯Šæ–­

### 2. æ€§èƒ½è€ƒè™‘
- ä»…åœ¨è°ƒè¯•æ¨¡å¼ä¸‹å¯ç”¨è¯¦ç»†æ£€æŸ¥
- é¿å…åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ä½¿ç”¨å®žæ—¶ç›‘æŽ§
- åˆç†è®¾ç½®ç›‘æŽ§é—´éš”

### 3. æ—¥å¿—ç®¡ç†
- UIæ£€æŸ¥å™¨ä½¿ç”¨LogManagerç»Ÿä¸€æ—¥å¿—æ¡†æž¶
- æ—¥å¿—ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶
- å¯ä»¥é€šè¿‡æ—¥å¿—çº§åˆ«æŽ§åˆ¶è¾“å‡ºè¯¦ç»†ç¨‹åº¦

### 4. æŠ¥å‘Šåˆ†æž
- å®šæœŸç”Ÿæˆå’Œä¿å­˜å¸ƒå±€æŠ¥å‘Š
- å¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„å¸ƒå±€å˜åŒ–
- ç”¨äºŽé—®é¢˜è¿½è¸ªå’Œæ€§èƒ½ä¼˜åŒ–

## æ‰©å±•åŠŸèƒ½

### è‡ªå®šä¹‰æ£€æŸ¥è§„åˆ™

```swift
// å¯ä»¥æ‰©å±•UILayoutDebuggeræ·»åŠ è‡ªå®šä¹‰æ£€æŸ¥
extension UILayoutDebugger {
    func checkCustomLayoutRules(_ view: NSView) -> [String] {
        var issues: [String] = []
        
        // è‡ªå®šä¹‰æ£€æŸ¥é€»è¾‘
        if view is NSButton && view.frame.height < 30 {
            issues.append("æŒ‰é’®é«˜åº¦è¿‡å°ï¼Œå»ºè®®è‡³å°‘30px")
        }
        
        return issues
    }
}
```

### é›†æˆåˆ°å…¶ä»–ç•Œé¢

```swift
// åœ¨ä»»ä½•NSViewControllerä¸­ä½¿ç”¨
class MyViewController: NSViewController {
    override func viewDidAppear() {
        super.viewDidAppear()
        
        // æ£€æŸ¥ç•Œé¢å¸ƒå±€
        view.inspectLayout(title: "æˆ‘çš„ç•Œé¢")
    }
}
```

## æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

1. **æ£€æŸ¥å™¨æ²¡æœ‰è¾“å‡º**
   - ç¡®è®¤LogManageræ—¥å¿—çº§åˆ«è®¾ç½®
   - æ£€æŸ¥æ˜¯å¦åœ¨ä¸»çº¿ç¨‹è°ƒç”¨

2. **æŠ¥å‘Šæ–‡ä»¶ä¿å­˜å¤±è´¥**
   - æ£€æŸ¥æ–‡æ¡£ç›®å½•æƒé™
   - ç¡®è®¤æ–‡ä»¶åæ ¼å¼æ­£ç¡®

3. **è‡ªåŠ¨ä¿®å¤æ— æ•ˆ**
   - æŸäº›çº¦æŸé—®é¢˜éœ€è¦æ‰‹åŠ¨ä¿®å¤
   - æ£€æŸ¥è§†å›¾çš„çº¦æŸè®¾ç½®

### è°ƒè¯•æŠ€å·§

1. **ä½¿ç”¨å»¶è¿Ÿæ£€æŸ¥**
   ```swift
   DispatchQueue.main.asyncAfter(deadline: .now() + 0.5) {
       // æ‰§è¡ŒUIæ£€æŸ¥
   }
   ```

2. **åˆ†æ­¥éª¤æ£€æŸ¥**
   ```swift
   // å…ˆæ£€æŸ¥åŸºæœ¬ç»“æž„
   view.inspectLayout(title: "åŸºæœ¬ç»“æž„")
   
   // å†æ£€æŸ¥è¯¦ç»†å¸ƒå±€
   UILayoutDebugger.shared.diagnoseLayout(view)
   ```

3. **ä¿å­˜æ£€æŸ¥ç»“æžœ**
   ```swift
   UIInspector.shared.saveLayoutReport(view, title: "é—®é¢˜è¯Šæ–­")
   ```

## æ€»ç»“

UIæ£€æŸ¥å™¨æ˜¯ä¸€ä¸ªå¼ºå¤§çš„GUIè°ƒè¯•å·¥å…·ï¼Œèƒ½å¤Ÿï¼š

- âœ… **å¿«é€Ÿå®šä½å¸ƒå±€é—®é¢˜**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œåˆ†æžç•Œé¢å¸ƒå±€
- âœ… **æä¾›è¯¦ç»†è¯Šæ–­ä¿¡æ¯**ï¼šç”Ÿæˆå®Œæ•´çš„è§†å›¾å±‚çº§å’Œå±žæ€§æŠ¥å‘Š
- âœ… **æ”¯æŒè‡ªåŠ¨ä¿®å¤**ï¼šä¿®å¤å¸¸è§çš„å¸ƒå±€é—®é¢˜
- âœ… **é€šç”¨æ€§å¼º**ï¼šå¯ç”¨äºŽä»»ä½•macOSåº”ç”¨ç¨‹åºçš„ç•Œé¢è°ƒè¯•
- âœ… **æ˜“äºŽé›†æˆ**ï¼šç®€å•çš„APIè°ƒç”¨å³å¯ä½¿ç”¨

é€šè¿‡ä½¿ç”¨UIæ£€æŸ¥å™¨ï¼Œæˆ‘ä»¬æˆåŠŸè¯Šæ–­å¹¶ä¿®å¤äº†JMSåè®®ç®¡ç†ç•Œé¢çš„å¸ƒå±€é—®é¢˜ï¼Œæé«˜äº†å¼€å‘æ•ˆçŽ‡å’Œç•Œé¢è´¨é‡ã€‚

---
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-08-18  
**é€‚ç”¨ç‰ˆæœ¬**: JMS Protocol Handler 1.2.0+
